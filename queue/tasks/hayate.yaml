task:
  acceptance_criteria:
  - description: docs/research/cmd_462_codex-stall-analysis.md が§1〜§4の構造で作成されていること
    id: AC1
  - description: ninja_monitor.logからCodex STALL事例が定量的に集計されていること
    id: AC2
  - description: STALL発生率がモデル別・タスク種別別に比較されていること
    id: AC3
  - description: 仮説が最低3つ、各仮説に検証可能な対策提案が付記されていること
    id: AC4
  assigned_to: hayate
  bloom_level: complex
  deployed_at: '2026-03-01T00:24:51'
  description: "【注入教訓】 必ず確認し reviewed: true に変更せよ\n  - L003: CLAUDE.mdやinstructions/*.mdを更新しても、既に稼働中のエージェントのコンテキストには反映されない。ninja_monitor.shにc\n\
    \  - L106: L303: load_lesson_summaries(os.path.dirname(data_file))は data_file=SCRIPT_DIR/lo\n\
    \  - L079: scripts/deploy_task.shのinject_related_lessons実行でrelated_lessons配列が再構築され、reviewed\n\
    \  - L052: cmd_318 hayate\n  - L048: check_and_update_done_taskがparent_cmdのみで判定していたためWave1報告doneがWave2タスクassignedを自動d\n\
    \  - L074: ((PASS++))はPASS=0の時に((0))を評価→exit code 1→set -eでスクリプト即終了。PASS=$((PASS+1))に変換必須。\n\
    \  - L063: 観点⑧のPythonコードが才蔵骨格実装時にdataを直接イテレーションしていた。lessons.yamlはトップレベルがdictでlessonsキー配下にリス\n\
    \  - L032: ##PJ名から次の##直前までが差替え対象。セクション内の###は区切りではない。才蔵設計\n────────────────────────────────────────\n\
    \nCodex忍者がタスクacknowledged後に作業を開始しない問題の原因調査。\n独立偵察（2名中1名）。もう1名の結論を知る必要はない。\n\n\
    ## 観点A: 自己分析\n- Codexとして、タスクYAMLを読んだ後に何が起きているか\n- acknowledgeまではできるのに、なぜその後の作業に入れないのか\n\
    - CLAUDE.mdの/clear Recovery手順のどの段階で止まるのか\n- タスクの複雑さ・説明の長さ・教訓注入量が影響しているか\n\n##\
    \ 観点B: 環境・設定調査\n- Codex CLIの挙動がClaude CLIと異なる点はあるか\n- WSL2上のCodex固有の制約・タイムアウト・レート制限\n\
    - config/cli_profiles.yamlのCodexプロファイルに不足・誤りはあるか\n\n## 観点C: 過去事例パターン分析\n- logs/ninja_monitor.logからCodex忍者のSTALL事例を収集\n\
    - STALL発生率: Codex vs Opus\n- タスク種別(impl/review/scout)ごとのSTALL率\n- 時間帯・CTX使用量との相関\n\
    \n## 成果物\ndocs/research/cmd_462_codex-stall-analysis.md\n- §1 自己分析結果\n- §2 環境・設定調査結果\n\
    - §3 過去事例パターン分析\n- §4 仮説と対策提案（最低3仮説、各仮説に検証可能な対策）\n\n## 注意\n- 偵察タスク。コード変更なし。調査レポートのみ。\n\
    - commitまで。pushするな。\n"
  parent_cmd: cmd_462
  project: infra
  related_lessons:
  - id: L003
    reviewed: true
    summary: CLAUDE.mdやinstructions/*.mdを更新しても、既に稼働中のエージェントのコンテキストには反映されない。ninja_monitor.shにcheck_script_update機能を追加し、スクリプト更新時に/clearを発動して再読み込みさせる仕組みで解決(cmd_125)。
  - id: L106
    reviewed: true
    summary: 'L303: load_lesson_summaries(os.path.dirname(data_file))は data_file=SCRIPT_DIR/logs/lesson_impact.tsvの場合にlogs/を渡す。'
  - id: L079
    reviewed: true
    summary: scripts/deploy_task.shのinject_related_lessons実行でrelated_lessons配列が再構築され、reviewed:trueが保持されない。結果として次回deploy_task.sh実行時にentrance_gateでBLOCKされる。
  - id: L052
    reviewed: true
    summary: cmd_318 hayate
  - id: L048
    reviewed: true
    summary: check_and_update_done_taskがparent_cmdのみで判定していたためWave1報告doneがWave2タスクassignedを自動done化した。task_id一致チェックをL311後に追加して修正済み
  - id: L074
    reviewed: true
    summary: ((PASS++))はPASS=0の時に((0))を評価→exit code 1→set -eでスクリプト即終了。PASS=$((PASS+1))に変換必須。
  - id: L063
    reviewed: true
    summary: 観点⑧のPythonコードが才蔵骨格実装時にdataを直接イテレーションしていた。lessons.yamlはトップレベルがdictでlessonsキー配下にリスト構造。for
      lesson in data.get('lessons',[])が正しい形
  - id: L032
    reviewed: true
    summary: '##PJ名から次の##直前までが差替え対象。セクション内の###は区切りではない。才蔵設計'
  report_filename: hayate_report_cmd_462.yaml
  report_template:
    filename_pattern: queue/reports/{ninja_name}_report_{cmd}.yaml
    forbidden:
    - コード変更するな（調査レポートのみ）
    - pushするな(commitまで)
    notes:
    - 偵察レポートは§1〜§4の全セクションを網羅せよ
    required_fields:
    - files_modified
    - lesson_candidate
    - lesson_referenced
  role_reminder: 忍者hayate。このタスクのみ実行せよ。スコープ外の改善・判断は禁止。発見はlesson_candidate/decision_candidateへ
  status: done
  subtask_id: subtask_462_recon_a
  task_type: scout
  title: Codex acknowledge-only問題の偵察 — 自己分析+パターン分析
