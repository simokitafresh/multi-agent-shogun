task:
  acceptance_criteria:
  - 'AC1: dashboard_auto_section.shのパイプラインからGATE CLEAR済み+status:completedのcmdが除外されること'
  - 'AC2: パイプラインが全て完了済みの場合「パイプライン空 — 次cmd待ち」が表示されること'
  - 'AC3: archive_completed.sh実行で最新更新セクションの古いエントリ（4件目以降）がarchiveに退避されること'
  - 'AC4: 既存のdashboard_auto_section.shのマーカー構造・戦果表示・メトリクスが壊れていないこと'
  assigned_to: hayate
  bloom_level: routine
  description: |
    佐助(impl_a)と霧丸(impl_b)の2名の実装を統合レビューし、
    既存動作が壊れていないことを確認する。

    ## レビュー観点

    1. dashboard_auto_section.sh変更(佐助):
       - CLEARED_CMDSのdeclare -Aがサブシェル外に正しく配置されていること
       - パイプラインフィルタでstatus:completedとCLEAR済みcmdが除外されること
       - フィルタ後0件時に「パイプライン空 — 次cmd待ち」が表示されること
       - 既存マーカー(DASHBOARD_AUTO_START/END)・戦果・メトリクスが維持されていること
       - bash -n構文チェックPASS

    2. archive_completed.sh変更(霧丸):
       - archive_karo_section()が正しく呼び出されること
       - 「## 最新更新」の直近3件が保持され、4件目以降が退避されること
       - flock排他パターンが正しいこと
       - archive先がarchive/dashboard_karo_archive.mdであること
       - 「## 最新更新」ヘッダ自体が削除されないこと
       - bash -n構文チェックPASS

    ## 統合テスト手順

    ```bash
    # 1. bash -n構文チェック
    bash -n scripts/dashboard_auto_section.sh
    bash -n scripts/archive_completed.sh

    # 2. dashboard_auto_section.sh実行 → パイプラインに完了cmdが含まれないこと確認
    bash scripts/dashboard_auto_section.sh
    # dashboard.mdのパイプラインセクションを確認

    # 3. archive_completed.sh実行 → 最新更新の古いエントリが退避されること確認
    bash scripts/archive_completed.sh
    # archive/dashboard_karo_archive.mdに退避されたことを確認
    ```

    ## 注意
    - レビューのみ。コード修正はしない（修正が必要な場合はlesson_candidateに記載）
    - 2名の報告YAMLを必ず確認してから統合テストに入ること
    - commit + pushはレビュー完了後のみ
  parent_cmd: cmd_445
  project: infra
  report_filename: hayate_report_cmd_445.yaml
  role_reminder: 忍者hayate。このタスクのみ実行せよ。スコープ外の改善・判断は禁止。発見はlesson_candidate/decision_candidateへ
  status: done
  reports_to_read:
  - queue/reports/sasuke_report_cmd_445.yaml
  - queue/reports/kirimaru_report_cmd_445.yaml
  subtask_id: subtask_445_review
  task_type: review
  title: ダッシュボード自動清掃 — 全体レビュー+統合テスト
